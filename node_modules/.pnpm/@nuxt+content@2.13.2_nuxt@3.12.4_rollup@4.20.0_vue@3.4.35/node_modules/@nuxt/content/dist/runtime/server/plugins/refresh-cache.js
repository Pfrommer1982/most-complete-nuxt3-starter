import { defineNitroPlugin } from "nitropack/runtime";
import { cleanCachedContents } from "../storage.js";
import { useStorage } from "#imports";
export default defineNitroPlugin(async (nitro) => {
  const storage = useStorage();
  const unwatch = await storage.watch(async (event, key) => {
    if (key.startsWith("content:source")) {
      cleanCachedContents();
    }
  });
  nitro.hooks.hook("close", async () => {
    typeof unwatch === "function" && await unwatch();
  });
});
